@page "/dashboard"
@page "/dashboard/{Months:int}/{UserId:int}"


@using RPS.Core.Models
@using RPS.Web.Components.Dashboard
@inject NavigationManager NavigationManager


<link rel="stylesheet" href="css/dashboard.css" />

<div class="container">
    <div class="row mb-4">
        <div class="col-md-6">
            <h1 class="display-4">Dashboard</h1>
        </div>
        <div class="col-md-6 d-flex justify-content-end align-items-center">
            <TelerikComboBox Data="@Assignees" TextField="FullName" ValueField="Id" @bind-Value="SelectedAssigneeId"
                             Placeholder="Select assignee.." ClearButton="true" Filterable="true" FilterOperator="StringFilterOperator.Contains" Width="260px">
                <ItemTemplate>
                    @{
                        var item = context as PtUser;

                        <div class="d-flex align-items-center">
                            <img src="@item.Avatar" class="li-avatar rounded mx-auto" />
                            <span class="ms-2">@item.FullName</span>
                        </div>
                    }

                </ItemTemplate>
            </TelerikComboBox>
        
            <TelerikButtonGroup SelectionMode="Telerik.Blazor.ButtonGroupSelectionMode.Single" class="ms-3">
                <ButtonGroupToggleButton Icon="SvgIcon.Calendar" OnClick="@(_ => DateRangeFilter(3))">3 Months</ButtonGroupToggleButton>
                <ButtonGroupToggleButton Icon="SvgIcon.Calendar" OnClick="@(_ => DateRangeFilter(6))">6 Months</ButtonGroupToggleButton>
                <ButtonGroupToggleButton Icon="SvgIcon.Calendar" OnClick="@(_ => DateRangeFilter(12))">1 Year</ButtonGroupToggleButton>
            </TelerikButtonGroup>
        </div>
    </div>
    <div class="row mb-4">
        <div class="col-md-3 text-center">
            <div class="bg-light p-3 rounded">
                <strong class="d-block display-4">@IssueCountActive</strong>
                <small>Active Issues</small>
            </div>
        </div>
        <div class="col-md-3 text-center">
            <div class="bg-light p-3 rounded">
                <strong class="d-block display-4 text-success">@IssueCountClosed</strong>
                <small>Closed Issues</small>
            </div>
        </div>
        <div class="col-md-3 text-center">
            <div class="bg-light p-3 rounded">
                <strong class="d-block display-4 text-primary">@IssueCountOpen</strong>
                <small>Open Issues</small>
            </div>
        </div>
        <div class="col-md-3 text-center">
            <div class="bg-light p-3 rounded">
                <strong class="d-block display-4">@IssueCloseRate</strong>
                <small>Close Rate</small>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <IssueChart Filter="Filter" @ref="IssueChartRef" />
        </div>
    </div>
</div>

@code {

}



@code {

    public IssueChart IssueChartRef { get; set; }

    private void DateRangeFilter(int months)
    {
        Months = months;
        UserId = UserId.HasValue ? UserId.Value : 0;
        NavigationManager.NavigateTo($"/dashboard/{Months}/{UserId}");
        Refresh();
    }

    void ItemResize()
    {
        IssueChartRef.RefreshTelerikChart();
    }
}
